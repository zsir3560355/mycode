<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
        <script>
            
            // var start = +new Date()
            // function foo() {
            //     setTimeout(function() {
            //         console.log('setTimeout')
            //         if((+new Date) - start < 1000) {
            //            foo()
            //         }
            //     })
            // }
            // foo()
            function disPromiseAll(promises){
                return new Promise((resolve,reject)=>{
                    if(!Array.isArray(promises)){
                        throw new TypeError("promises must be an array")
                    }
                    let result = [];
                    let count = 0;
                    promises.forEach((promise,index)=>{
                        promise.then(res=>{
                            result[index] = res;
                            count++;
                            count == promises.length && resolve(result)
                        },(err)=>{
                            reject(err)
                        })
                    })
                })
            }
            
            function promiseAll(promises){
                return new promise((resolve,reject) => {
                    if(!Array.isArray(promises)){
                        throw new TypeError("promises must be an array")
                    }
                    let result = [];
                    let count = 0;
                    promises.forEach((promise,index) => {
                        promise.then( res=>{
                            result[index] = res;
                            count++;
                            count == promises.length && resolve(result)
                        },err=>{
                            reject(err)
                        })
                    })
                })
            }
            
            let x = [1,2,3]; 
            let y = x; 
            let z = [4,5,6]; 
            // let x = [10,2,30]; 
            // let y = [10,2,30]; 
            // let z = [4,20,6]; 
            y[0] = 10; 
            y = z; 
            z[1] = 20; 
            x[2] = z = 30;

            console.log(x,y,z) //
            let a = 0;
            let pro1 = new Promise((resolve,reject)=>{
                setTimeout(()=>{
                    resolve(++a)
                },1000)
            })     

            let pro2 = new Promise((resolve,reject)=>{
                setTimeout(()=>{
                    resolve(++a)
                },2000)
            })   

            let pro3 = new Promise((resolve,reject)=>{
                setTimeout(()=>{
                    resolve(++a)
                },3000)
            })

            let pro4 = new Promise((resolve,reject)=>{
                setTimeout(()=>{
                    resolve(++a)
                },4000)
            })

            // Promise.all([pro1,pro2,pro3,pro4]).then(res=>{
            //     console.log(res);
            // })

            // Promise.race([pro1,pro2,pro3,pro4]).then(res=>{
            //     console.log(res)
            // })

            // function Promise(executor){
            //     let self  = this;
            //     self.status = 'pending';
            //     self.data = undefined;
            //     self.onResolvedCallback = [];
            //     self.onRejectedCallback = [];
            //     executor(resolve,reject)
            //     // console.log("executor=>",executor)
            //     function resolve(value){
            //         setTimeout(function(){
            //             if(self.status == 'pending'){
            //                 self.status = 'resolved';
            //                 self.data = value;
            //                 for(let i = 0; i < self.onResolvedCallback.length; i++ ){
            //                     self.onResolvedCallback[i](value)
            //                 }   
            //             }
            //         })
            //     }

            //     function reject(reason){
            //         setTimeout(function(){
            //             if(self.status == 'pending'){
            //                 self.status = 'rejected';
            //                 self.data = reason;
            //                 for(let i = 0; i < self.onRejectedCallback.length; i++ ){
            //                     self.onRejectedCallback[i](reason)
            //                 }   
            //             } 
            //         })
            //     }
            //     try{
            //         executor(resolve,reject)
            //     }catch(error){
            //         reject(reject)
            //     }
                
            // }

            // Promise.prototype.then = function(onResolved,onRejected){
            //     let self = this;
            //     let promise2;
            //     console.log(self)
            //     console.log("onResolved=>",onResolved);
            //     console.log("onRejected=>",onRejected);
            //     onResolved = typeof onResolved === 'function' ? onResolved : function(value){return value};
            //     onRejected = typeof onRejected === 'function' ? onResolved : function(reason){throw reason};
            //     if(self.status === 'resolved'){
            //         return promise2 = new Promise(function(resolve,reject){
            //             setTimeout(function(){
            //                 try{
            //                     let x = onResolved(self.data);
            //                     resolvePromise(promise2, x, resolve, reject)
            //                 }catch(reason){
            //                     reject(reason)
            //                 }
            //             })
            //         })
            //     }
            //     if(self.status === 'rejected'){
            //         return promise2 = new Promise(function(resolve,reject){
            //             setTimeout(function(){
            //                 try{
            //                     let x = onRejected(self.data);
            //                     resolvePromise(promise2, x, resolve, reject)
            //                 }catch(reason){
            //                     reject(reason)
            //                 }
            //             })
            //         })
            //     }
            //     if(self.status === 'pending'){
            //         return promise2 = new Promise(function(resolve,reject){
            //             self.onResolvedCallback.push(function(value){
            //                     try{
            //                         let x = onResolved(self.data);
            //                         resolvePromise(promise2, x, resolve, reject)
            //                     }catch(error){
            //                         reject(error)
            //                     }
            //             })

            //             self.onRejectedCallback.push(function(reason){
            //                 try{
            //                     let x = onRejected(self.data);
            //                     resolvePromise(promise2, x, resolve, reject)
            //                 }catch(err){
            //                     reject(err)
            //                 }
            //             })
            //         })
            //     }
            // }
            
            // Promise.prototype.catch = function(onRejected){
            //     return  this.then(null,onRejected)
            // }
            
            // function resolvePromise(promise2,x,resolve,reject){
            //      let then
            //      let thenCalledOrThrow  = false;
            //      if(promise2 === x){
            //            return reject(new  TypeError('Chaining cycle detected for promise')) 
            //      }
            //      if(x instanceof Promise){
            //          if(x.status == 'pending'){
            //             x.then(function(value){
            //                 resolvePromise(promise2,value,resolve,reject)
            //             },reject)
            //          }else{
            //             x.then(resolve,reject)
            //          }
            //          then
            //      }

            //      if((x !== null) && ((typeof x === 'object') || (typeof x === 'function'))){
            //          try{
            //             then = x.then;
            //             if(typeof x === 'function'){
            //                 then.call(x,function rs(y){
            //                     if (thenCalledOrThrow) return // 2.3.3.3.3 即这三处谁选执行就以谁的结果为准
            //                     thenCalledOrThrow = true
            //                     return resolvePromise(promise2, y, resolve, reject)    
            //                 }, function rj(r) { // 2.3.3.3.2
            //                     if (thenCalledOrThrow) return // 2.3.3.3.3 即这三处谁选执行就以谁的结果为准
            //                     thenCalledOrThrow = true
            //                     return reject(r)
            //                 })
            //             }else{
            //                 resolve(x)
            //             }
            //          }catch(err){
            //               if (thenCalledOrThrow) return // 2.3.3.3.3 即这三处谁选执行就以谁的结果为准
            //                 thenCalledOrThrow = true
            //                 return reject(e)
            //         }
            //     }else{
            //         resolve(x)
            //     }

            // }
            
            const promise = new Promise((resolve,reject)=>{
                setTimeout(()=>{
                    resolve(1)
                },2000);
            }).then(a=>{
                console.log(a);
                return a
            }).then(a=>{
                console.log(b);
            }).catch(err=>{
                console.log(err)
            }).finally(()=>{
                console.log("finnally")
            })
          

            // new Promise(resolve=>resolve(8))
            // .then(function(value){
            //     return(value+100)
            // })
            // .then(function foo(value) {
            //    alert(value);
            // })
        </script>
</body>
</html>